@{
    Layout = null;
}
@model Partial_Document
<link href="~/edit/edit.css" rel="stylesheet" />
<script src="~/edit/edit.js"></script>
<div class="document_body">
    <div class="left">
        <span class="title" style="margin-top:0 !important;">@Model.Title</span>
        <div class="context_edit">
            @Html.Raw(Model.Content)
        </div>
    </div>
    <div class="right">
        <div class="ui form tiny">
            <div class="field">
                <label>版本</label>
                <div class="ui floating labeled icon dropdown button" id="setVersion" data-value="@Model.ID">
                    <input type="hidden" value="@Model.NowVersion">
                    <i class="code branch icon"></i>
                    <span class="text"></span>
                    <div class="menu">
                        @foreach (var item in Model.Versions)
                        {
                            <div class="item" data-value="@item"># @(item)</div>
                        }
                    </div>
                </div>
            </div>
            <div class="field">
                <label>优先级</label>
                <div class="ui disabled rating" id="EmergencyLevel" data-icon="star" data-rating="@Model.EmergencyLevel" data-max-rating="5"></div>
            </div>
            <div class="field">
                <label>项目</label>
                <div class="ui label basic">
                    <i class="briefcase icon"></i> @G.NowProject.ProjectName
                </div>
            </div>
            <div class="field">
                <label>类型</label>
                <div class="ui label basic">
                    @Model.MType
                </div>
            </div>
            <div class="field">
                <label>模块</label>
                <div class="ui label basic">
                    @Model.ModuleName
                </div>
            </div>
            <div class="field">
                <label>评审</label>
                <div class="ui image label basic">
                    <img src="@Model.User_Avatar">
                    @Model.User_Name
                </div>
            </div>
        </div>
        @if (Model.ShowTasks)
        {
            <div class="ui horizontal divider">
                <i class="tasks icon"></i>
                任务
            </div>
            @if (Model.Tasks.Count > 0)
            {
                <div class="ui comments mini">
                    @foreach (var item in Model.Tasks)
                    {
                        <div class="comment">
                            <div class="avatar">
                                <img src="@item.ExecutorUser.Avatar">
                            </div>
                            <div class="content">
                                <span class="author">@item.ExecutorUser.UserName</span>
                                <div class="text url" style="margin-top:.1em;">
                                    @switch (item.Status)
                                    {
                                        case DBEnums.TasksStatus.进行:
                                            <i class="play circle outline icon orange" style="font-size: 12px;margin: 0px;" title="@item.Status"></i>
                                            break;
                                        case DBEnums.TasksStatus.完成:
                                            <i class="check circle outline icon green" style="font-size: 12px;margin: 0px;" title="@item.Status"></i>
                                            break;
                                        case DBEnums.TasksStatus.终止:
                                            <i class="stop circle outline icon red" style="font-size: 12px;margin: 0px;" title="@item.Status"></i>
                                            break;
                                    }
                                    <a onclick="page_action.viewtask(@item.TaskID)"><span>[#@item.TaskID]</span>@item.Title</a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <span class="ui grey text">无</span>
            }
        }
        <div class="ui horizontal divider">
            <i class="history icon"></i>
            记录
        </div>
        <div class="ui comments mini">
            @foreach (var item in Model.Logs.OrderBy(c => c.CreateDate))
            {
                <div class="comment">
                    <div class="avatar">
                        <img src="@item.User.Avatar">
                    </div>
                    <div class="content">
                        <span class="author">@item.User.UserName</span>
                        <div class="metadata">
                            <span class="date">@item.CreateDate</span>
                        </div>
                        <div class="text">
                            @Html.Raw(item.Content)
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>