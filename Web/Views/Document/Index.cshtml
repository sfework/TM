@{
    ViewData["Title"] = "文档管理";
}
@model Web.ParamModels.Document.Document_Request
<style>
    body { display: flex; flex-direction: column; overflow: hidden; }
    .Context { flex: 1; overflow: hidden; }
    .Context > .context_box { height: 100%; display: flex; flex-direction: column; overflow: hidden; }
    .Context > .context_box > .searchbox { height: 33px; }
    .Context > .context_box > .file_list { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .Context > .context_box > .file_list > .thr { height: 63px; }
    .Context > .context_box > .file_list > .files_box { flex: 1; overflow-y: scroll; }
    .Context::-webkit-scrollbar { width: 12px; }
    .Context::-webkit-scrollbar-thumb { border-radius: 0px; cursor: pointer; }
    .files_box { }
    .files_box > .file { border: solid 1px #fff; float: left; margin-right: 8px; cursor: pointer; border-radius: 5px; padding: 5px; position: relative; }
    .files_box > .file > .tag { position: absolute; width: 15px; }
    .files_box > .file > .tag > .icon { margin: 0 !important; }
    .files_box > .file > .tag > .grey { color: #b1b1b1 !important; }
    .files_box > .file > .tools { position: absolute; width: 15px; right: 7px; display: none; }
    .files_box > .file:hover > .tools { display: block; }
    .files_box > .file:hover > .tools > .noaction { padding: .2em .2em; border-radius: 2px; }
    .files_box > .file:hover { box-shadow: inset 0px 0px 4px 1px #ececec; }

    .files_box > .file > .text { text-align: center; width: 75px; line-height: 14px; height: 42px; overflow: hidden; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; text-overflow: ellipsis; }
</style>
<link href="https://cdn.bootcss.com/jodit/3.3.24/jodit.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/jodit/3.3.24/jodit.min.js"></script>
<div class="context_box">
    <div class="searchbox" data-tag="document_search">
        <div class="ui form mini">
            <div class="inline fields">
                <div class="field">
                    <label>关键字</label>
                    <div class="ui input clearable">
                        <input type="text" id="KeyWord" value="@Model.KeyWord">
                        <i class="close icon"></i>
                    </div>
                </div>
                <div class="field">
                    <button class="ui button orange mini icon" id="search"><i class="icon search"></i></button>
                </div>
                <div class="field right">
                    <div class="ui floating labeled icon dropdown button teal noaction tiny">
                        <i class="plus icon"></i>
                        <span class="text">新建</span>
                        <div class="menu">
                            <div class="item" onclick="page_action.new(0)">文件夹</div>
                            <div class="item" onclick="page_action.new(1)">在线文档</div>
                            <div class="item" onclick="page_action.new(2)">附件</div>
                            <div class="item" onclick="page_action.new(3)">链接</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="file_list">
        <div class="thr">
            <div class="ui divider" style="margin-top:10px;margin-bottom:9px;"></div>
            <div class="ui breadcrumb" id="path_id" data-id="@(Model.IsSearch?"":Model.DocumentID)" style="height:25px;">
                @if (Model.IsSearch)
                {
                    <div class="section"><i class="icon search"></i>搜索："@Model.KeyWord"</div>
                }
                else
                {
                    if (string.IsNullOrWhiteSpace(Model.DocumentID))
                    {
                        <div class="section"><i class="icon home"></i>Home</div>
                    }
                    else
                    {
                        <a class="section" onclick="page_action.load()"><i class="icon home"></i>Home</a>
                    }
                    foreach ((int, string, string, bool) item in Model.Paths)
                    {
                        <div class="divider"> / </div>
                        if (item.Item4)
                        {
                            <a class="section" onclick="page_action.load('@item.Item2')"><i class="folder open icon"></i>@item.Item3</a>
                        }
                        else
                        {
                            <div class="section"><i class="folder open icon"></i>@item.Item3</div>
                        }
                    }
                }
            </div>
            <div class="ui divider" style="margin-top:5px;margin-bottom:10px;"></div>
        </div>
        <div class="files_box">
            @foreach (var item in Model.List)
            {
                <div class="file">
                    <div class="tag">
                        @if (item.IsPublic)
                        {
                            <i class="unlock icon grey"></i>
                        }
                        @if (item.IsShare)
                        {
                            <i class="share alternate icon grey"></i>
                        }
                    </div>
                    <div class="tools">
                        <div class="ui icon top left pointing dropdown button mini noaction">
                            <i class="angle down icon"></i>
                            <div class="menu">
                                @if (item.CreateUserID == User.UserID)
                                {
                                    <div class="item" onclick="page_action.new(@item.DocumentType,'@item.DocumentID')">编辑</div>
                                }
                                @if (item.IsShare)
                                {
                                    <div class="item" onclick="page_action.copy('@(Model.SharePath+item.DocumentID)')">分享</div>
                                }
                                @if (item.CreateUserID == User.UserID)
                                {
                                    <div class="item" onclick="page_action.del('@item.DocumentID')">删除</div>
                                }
                            </div>
                        </div>
                    </div>
                    @switch (item.DocumentType)
                    {
                        case 0:
                            <div class="f_icon @item.Class" onclick="page_action.load('@item.DocumentID')"></div>
                            break;
                        case 1:
                            <div class="f_icon @item.Class" onclick="page_action.view_doc('@item.DocumentID')"></div>
                            break;
                        case 2:
                            <div class="f_icon @item.Class" onclick="page_action.view_att('@item.DocumentID')"></div>
                            break;
                        case 3:
                            <a class="f_icon @item.Class" href="@item.Content" target="_blank"></a>
                            break;
                    }
                    <div class="text" title="@item.DocumentName">@item.DocumentName</div>
                </div>
            }
        </div>
        <div style="clear: both;"></div>
    </div>
</div>
<script>
    var page_action = {
        new: function (tp, id) {
            var pid = $('#path_id').data('id');
            var url = '/Document/Add?PathID=' + pid + '&DocumentType=' + tp;
            if (id) {
                url += '&DocumentID=' + id;
            }
            modal.load(url, 400)
        },
        load: function (did) {
            var url = '/Document/Index';
            if (did) {
                url += '?DocumentID=' + did;
            }
            window.location.href = url;
        },
        reload: function () {
            window.location.reload();
        },
        init: function () {
            //无操作的下拉框
            $('.ui.dropdown.noaction[tabindex!="0"]').dropdown({ 'action': 'hide' });
        },
        copy: function (text) {
            copyToClipboard(text);
            tip.success('分享链接已复制到剪贴板！')
        },
        del: function (did) {
            modal.ask('确认删除此文档？', function () {
                ajax.post('/Document/Delete', { DocumentID: did }, null, function (s, d) {
                    if (s && d.Success) {
                        window.location.reload();
                    }
                });
            });
        },
        view_doc: function (did) {
            modal.load('/Document/Document_View?DocumentID=' + did, 1000)
        },
        view_att: function (did) {
            modal.load('/Document/Attachment_View?DocumentID=' + did, 400)
        }
    };
    page_action.init();
</script>