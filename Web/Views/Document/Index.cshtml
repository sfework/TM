@{
    ViewData["Title"] = "文档管理";
}
@model Web.ParamModels.Document.Document_Request
<style>
    .files_box { overflow-y: scroll; }
    .files_box > .file { border: solid 1px #fff; float: left; margin-right: 8px; cursor: pointer; border-radius: 5px; padding: 5px; position: relative; }
    .files_box > .file > .tag { position: absolute; width: 15px; }
    .files_box > .file > .tag > .icon { margin: 0 !important; }
    .files_box > .file > .tag > .grey { color: #b1b1b1 !important; }
    .files_box > .file > .tools { position: absolute; width: 15px; right: 7px; display: none; }
    .files_box > .file:hover > .tools { display: block; }
    .files_box > .file:hover > .tools > .noaction { padding: .2em .2em; border-radius: 2px; }
    .files_box > .file:hover { box-shadow: inset 0px 0px 4px 1px #ececec; }
    .files_box > .file > .text { text-align: center; width: 75px; line-height: 14px; height: 42px; overflow: hidden; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; text-overflow: ellipsis; }
</style>
<link href="~/edit/edit.css" rel="stylesheet" />
<script src="~/edit/edit.js"></script>
<div class="searchbox">
    <div class="ui form tiny">
        <div class="inline fields">
            <div class="field">
                <label>关键字</label>
                <div class="ui input clearable">
                    <input type="text" id="KeyWord" value="@Model.KeyWord">
                    <i class="close icon"></i>
                </div>
            </div>
            <div class="field">
                <button class="ui button orange icon" id="search"><i class="icon search"></i></button>
            </div>
            @if (!Model.IsSearch)
            {
                <div class="field right">
                    <div class="ui floating labeled icon dropdown button teal noaction tiny">
                        <i class="plus icon"></i>
                        <span class="text">新建</span>
                        <div class="menu">
                            <div class="item" onclick="page_action.new('@Model.DocumentID',0)">文件夹</div>
                            <div class="item" onclick="page_action.new('@Model.DocumentID',1)">在线文档</div>
                            <div class="item" onclick="page_action.new('@Model.DocumentID',2)">附件</div>
                            <div class="item" onclick="page_action.new('@Model.DocumentID',3)">链接</div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
<div class="file_list" style="flex:1;overflow:hidden;display:flex;flex-direction:column;">
    <div class="thr">
        <div class="ui divider" style="margin-top:10px;margin-bottom:9px;"></div>
        <div class="ui breadcrumb" style="height:25px;">
            @if (Model.IsSearch)
            {
                <a class="section" href="/Document/Index"><i class="icon home"></i>Home</a>
                <div class="divider"> - </div>
                <div class="section"><i class="icon search"></i>搜索："@Model.KeyWord"</div>
            }
            else
            {
                if (string.IsNullOrWhiteSpace(Model.DocumentID))
                {
                    <div class="section"><i class="icon home"></i>Home</div>
                }
                else
                {
                    <a class="section" href="/Document/Index"><i class="icon home"></i>Home</a>
                }
                foreach ((int, string, string, bool) item in Model.Paths)
                {
                    <div class="divider"> / </div>
                    if (item.Item4)
                    {
                        <a class="section" href="/Document/Index?DocumentID=@item.Item2"><i class="folder open icon"></i>@item.Item3</a>
                    }
                    else
                    {
                        <div class="section"><i class="folder open icon"></i>@item.Item3</div>
                    }
                }
            }
        </div>
        <div class="ui divider" style="margin-top:5px;margin-bottom:10px;"></div>
    </div>
    <div class="files_box" style="overflow-x: hidden;overflow-y: auto;flex: 1;position:relative;">
        @foreach (var item in Model.List)
        {
            <div class="file">
                <div class="tag">
                    @if (item.IsPublic)
                    {
                        <i class="unlock icon grey"></i>
                    }
                    @if (item.IsShare)
                    {
                        <i class="share alternate icon grey"></i>
                    }
                </div>
                <div class="tools">
                    <div class="ui icon top left pointing dropdown button mini noaction">
                        <i class="angle down icon"></i>
                        <div class="menu">
                            @if (item.CreateUserID == G.User.UserID)
                            {
                                <div class="item" onclick="page_action.new('@Model.DocumentID',@item.DocumentType,'@item.DocumentID')">编辑</div>
                            }
                            @if (item.IsShare)
                            {
                                <div class="item" onclick="page_action.copy('@(Model.SharePath+item.DocumentID)')">分享</div>
                            }
                            @if (item.CreateUserID == G.User.UserID)
                            {
                                <div class="item" onclick="page_action.del('@item.DocumentID')">删除</div>
                            }
                        </div>
                    </div>
                </div>
                @switch (item.DocumentType)
                {
                    case 0:
                        <a class="f_icon @item.Class" href="/Document/Index?DocumentID=@item.DocumentID"></a>
                        break;
                    case 1:
                        <div class="f_icon @item.Class" onclick="page_action.view_doc('@item.DocumentID')"></div>
                        break;
                    case 2:
                        <div class="f_icon @item.Class" onclick="page_action.view_att('@item.DocumentID')"></div>
                        break;
                    case 3:
                        <a class="f_icon @item.Class" href="@item.Content" target="_blank"></a>
                        break;
                }
                <div class="text" title="@item.DocumentName">@item.DocumentName</div>
            </div>
        }
    </div>
    <div style="clear: both;"></div>
</div>
<script>
    var page_action = {
        new: function (pid, tp, id) {
            var url = '/Document/Add?PathID=' + pid + '&DocumentType=' + tp;
            if (id) {
                url += '&DocumentID=' + id;
            }
            modal.load(url, 400)
        },
        copy: function (text) {
            copyToClipboard(text);
            tip.success('分享链接已复制到剪贴板！')
        },
        del: function (did) {
            modal.ask('确认删除此文档？', function () {
                ajax.post('/Document/Delete', { DocumentID: did }, null, function (s, d) {
                    if (s && d.Success) {
                        window.location.reload();
                    }
                });
            });
        },
        view_doc: function (did) {
            modal.load('/Document/Document_View?DocumentID=' + did, null,'overlay fullscreen')
        },
        view_att: function (did) {
            modal.load('/Document/Attachment_View?DocumentID=' + did, 380)
        },
        view_test: function () {
            $('#s_test')
                .transition({ animation: 'zoom', duration: 200 });
        }
    };
</script>