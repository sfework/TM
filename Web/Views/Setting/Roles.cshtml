@{
    ViewData["Title"] = "角色管理";
}
@model Setting.RolesList
<style>
    .left_clear { clear: none !important; float: left; margin-right: 10px !important; }
    .rolesA .ui.list { margin: .5em 0 !important; }
    .ui.form .grouped.fields .field { margin: 0px !important; }
</style>
<div class="searchbox">
    <div class="ui form tiny">
        <div class="inline fields">
            <div class="field">
                <label>关键字</label>
                <div class="ui input clearable">
                    <input type="text" id="KeyWord" value="@Model.KeyWord">
                    <i class="close icon"></i>
                </div>
            </div>
            <div class="field">
                <button class="ui button orange icon" id="search"><i class="icon search"></i></button>
            </div>
            <div class="field right">
                <div class="ui floating teal labeled icon button tiny" onclick="modal.load('/Setting/Roles_Add',650)">
                    <i class="plus icon"></i>新增
                </div>
            </div>
        </div>
    </div>
</div>
<div class="Context_Scroll" style="padding:3px;">
    <div class="ui styled fluid accordion">
        @foreach (var item in Model.List)
        {
            <div class="title">
                <i class="dropdown icon"></i>
                <span>@item.RoleName</span>
                <div style="display:inline-block;float:right;margin-top:-4px;">
                    <div class="ui buttons icon mini blue">
                        @if (item.IsAllowDelete)
                        {
                            <button class="ui button" onclick="page.edit(@item.RoleID)"><i class="edit icon"></i></button>
                            <button class="ui button" onclick="page.del(@item.RoleID)"><i class="trash alternate icon"></i></button>
                        }
                        else
                        {
                            <button class="ui button disabled"><i class="edit icon"></i></button>
                            <button class="ui button disabled"><i class="trash alternate icon"></i></button>
                        }
                    </div>
                </div>
            </div>
            <div class="content" style="padding:.5em 1em 0.5em 1.5em;">
                <div style="float:left;width:100%;font-size:12px;">
                    @{
                        var Auths = string.IsNullOrWhiteSpace(item.Auths) ? new int[] { } : Array.ConvertAll(item.Auths.Split(new char[] { ',' }, StringSplitOptions.RemoveEmptyEntries), c => int.Parse(c));
                    }
                    @foreach (var L1 in Web.Command.AuthHelp.Get())
                    {
                        <div style="float:left;margin-right:15px;margin-bottom:15px;">
                            <div class="header" style="font-weight:bold;padding-left:3px;margin-bottom:6px;">@L1.Tag</div>
                            <div class="ui list" style="margin-top:5px;">
                                @foreach (var L2 in L1.Auths)
                                {
                                    <div class="item">
                                        @if (Auths.Contains(L2.Value))
                                        {
                                            <i class="circle grey icon"></i>
                                        }
                                        else
                                        {
                                            <i class="circle outline icon grey"></i>
                                        }
                                        <div class="content" style="padding-left:0;">
                                            @L2.Key
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
                <div style="clear:both;"></div>
            </div>
        }
    </div>
</div>

<script>
    var page = {
        init: () => {
            $('.ui.accordion').accordion();
        },
        edit: function (id) {
            event.stopPropagation();
            modal.load('/Setting/Roles_Add?RoleID=' + id, 650)
        },
        del: function (id) {
            event.stopPropagation();
            modal.ask('确认删除此角色？', function () {
                ajax.post('/Setting/Roles_Add_Del', { RoleID: id }, null, function (s, d) {
                    if (s && d.Success) {
                        window.location.reload();
                    }
                });
            });
        }
    };
    page.init();
</script>